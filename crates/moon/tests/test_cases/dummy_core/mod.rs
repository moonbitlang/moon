use super::*;
use expect_test::expect_file;

#[test]
fn test_dummy_core() {
    let test_dir = TestDir::new("dummy_core");
    let dir = dunce::canonicalize(test_dir.as_ref()).unwrap();

    snapbox::cmd::Command::new(moon_bin())
        .current_dir(&dir)
        .args(["check", "--sort-input"])
        .assert()
        .success();

    #[cfg(unix)]
    {
        let p = dir.join("target/packages.json");
        expect_file!["./dummy_core_wasm_gc.json.snap"]
            .assert_eq(&replace_dir(&std::fs::read_to_string(p).unwrap(), &dir))
    }
    snapbox::cmd::Command::new(moon_bin())
        .current_dir(&dir)
        .args(["check", "--target", "js", "--sort-input"])
        .assert()
        .success();

    #[cfg(unix)]
    {
        let p = dir.join("target/packages.json");
        expect_file!["./dummy_core_js.json.snap"]
            .assert_eq(&replace_dir(&std::fs::read_to_string(p).unwrap(), &dir))
    };

    check(
        get_stdout(&dir, ["check", "--dry-run", "--sort-input"]),
        expect![[r#"
            moonc check -o ./target/wasm-gc/release/check/prelude/prelude.mi -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target wasm-gc -workspace-path .
            moonc check -include-doctests -o ./target/wasm-gc/release/check/prelude/prelude.blackbox_test.mi -pkg moonbitlang/core/prelude_blackbox_test -i ./target/wasm-gc/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/prelude_blackbox_test:./prelude -target wasm-gc -blackbox-test -workspace-path .
            moonc check -o ./target/wasm-gc/release/check/coverage/coverage.mi -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target wasm-gc -workspace-path .
            moonc check -o ./target/wasm-gc/release/check/iter/iter.mi -pkg moonbitlang/core/iter -i ./target/wasm-gc/release/check/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm-gc -workspace-path .
            moonc check -include-doctests -o ./target/wasm-gc/release/check/iter/iter.blackbox_test.mi -pkg moonbitlang/core/iter_blackbox_test -i ./target/wasm-gc/release/check/iter/iter.mi:iter -i ./target/wasm-gc/release/check/coverage/coverage.mi:coverage -i ./target/wasm-gc/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/iter_blackbox_test:./iter -target wasm-gc -blackbox-test -workspace-path .
            moonc check -include-doctests -o ./target/wasm-gc/release/check/coverage/coverage.blackbox_test.mi -pkg moonbitlang/core/coverage_blackbox_test -i ./target/wasm-gc/release/check/coverage/coverage.mi:coverage -i ./target/wasm-gc/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/coverage_blackbox_test:./coverage -target wasm-gc -blackbox-test -workspace-path .
            moonc check -o ./target/wasm-gc/release/check/char/char.mi -pkg moonbitlang/core/char -i ./target/wasm-gc/release/check/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm-gc -workspace-path .
            moonc check -include-doctests -o ./target/wasm-gc/release/check/char/char.blackbox_test.mi -pkg moonbitlang/core/char_blackbox_test -i ./target/wasm-gc/release/check/char/char.mi:char -i ./target/wasm-gc/release/check/coverage/coverage.mi:coverage -i ./target/wasm-gc/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/char_blackbox_test:./char -target wasm-gc -blackbox-test -workspace-path .
            moonc check ./1/lib.mbt ./1/x.wasm-gc.mbt -o ./target/wasm-gc/release/check/1/1.mi -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -workspace-path .
            moonc check ./2/lib.mbt -o ./target/wasm-gc/release/check/2/2.mi -pkg moonbitlang/core/2 -i ./target/wasm-gc/release/check/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm-gc -workspace-path .
            moonc check -doctest-only ./2/lib.mbt -include-doctests -o ./target/wasm-gc/release/check/2/2.blackbox_test.mi -pkg moonbitlang/core/2_blackbox_test -i ./target/wasm-gc/release/check/2/2.mi:2 -i ./target/wasm-gc/release/check/1/1.mi:1 -i ./target/wasm-gc/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/2_blackbox_test:./2 -target wasm-gc -blackbox-test -workspace-path .
            moonc check ./1/lib.mbt ./1/x.wasm-gc.mbt ./1/x_wbtest.wasm-gc.mbt -o ./target/wasm-gc/release/check/1/1.whitebox_test.mi -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -whitebox-test -workspace-path .
            moonc check -doctest-only ./1/lib.mbt -doctest-only ./1/x.wasm-gc.mbt -include-doctests -o ./target/wasm-gc/release/check/1/1.blackbox_test.mi -pkg moonbitlang/core/1_blackbox_test -i ./target/wasm-gc/release/check/1/1.mi:1 -i ./target/wasm-gc/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/1_blackbox_test:./1 -target wasm-gc -blackbox-test -workspace-path .
            moonc check ./0/lib.mbt ./0/y.wasm-gc.mbt ./0/y_wbtest.mbt ./0/y_wbtest.wasm-gc.mbt -o ./target/wasm-gc/release/check/0/0.whitebox_test.mi -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -whitebox-test -workspace-path .
            moonc check ./0/lib.mbt ./0/y.wasm-gc.mbt -o ./target/wasm-gc/release/check/0/0.mi -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -workspace-path .
            moonc check -doctest-only ./0/lib.mbt -doctest-only ./0/y.wasm-gc.mbt -include-doctests -o ./target/wasm-gc/release/check/0/0.blackbox_test.mi -pkg moonbitlang/core/0_blackbox_test -i ./target/wasm-gc/release/check/0/0.mi:0 -i ./target/wasm-gc/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/0_blackbox_test:./0 -target wasm-gc -blackbox-test -workspace-path .
        "#]],
    );
    check(
        get_stdout(
            &dir,
            ["check", "--dry-run", "--target", "wasm", "--sort-input"],
        ),
        expect![[r#"
            moonc check -o ./target/wasm/release/check/prelude/prelude.mi -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target wasm -workspace-path .
            moonc check -include-doctests -o ./target/wasm/release/check/prelude/prelude.blackbox_test.mi -pkg moonbitlang/core/prelude_blackbox_test -i ./target/wasm/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/prelude_blackbox_test:./prelude -target wasm -blackbox-test -workspace-path .
            moonc check -o ./target/wasm/release/check/coverage/coverage.mi -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target wasm -workspace-path .
            moonc check -o ./target/wasm/release/check/iter/iter.mi -pkg moonbitlang/core/iter -i ./target/wasm/release/check/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm -workspace-path .
            moonc check -include-doctests -o ./target/wasm/release/check/iter/iter.blackbox_test.mi -pkg moonbitlang/core/iter_blackbox_test -i ./target/wasm/release/check/iter/iter.mi:iter -i ./target/wasm/release/check/coverage/coverage.mi:coverage -i ./target/wasm/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/iter_blackbox_test:./iter -target wasm -blackbox-test -workspace-path .
            moonc check -include-doctests -o ./target/wasm/release/check/coverage/coverage.blackbox_test.mi -pkg moonbitlang/core/coverage_blackbox_test -i ./target/wasm/release/check/coverage/coverage.mi:coverage -i ./target/wasm/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/coverage_blackbox_test:./coverage -target wasm -blackbox-test -workspace-path .
            moonc check -o ./target/wasm/release/check/char/char.mi -pkg moonbitlang/core/char -i ./target/wasm/release/check/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm -workspace-path .
            moonc check -include-doctests -o ./target/wasm/release/check/char/char.blackbox_test.mi -pkg moonbitlang/core/char_blackbox_test -i ./target/wasm/release/check/char/char.mi:char -i ./target/wasm/release/check/coverage/coverage.mi:coverage -i ./target/wasm/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/char_blackbox_test:./char -target wasm -blackbox-test -workspace-path .
            moonc check ./1/lib.mbt ./1/x.wasm.mbt -o ./target/wasm/release/check/1/1.mi -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm -workspace-path .
            moonc check ./2/lib.mbt -o ./target/wasm/release/check/2/2.mi -pkg moonbitlang/core/2 -i ./target/wasm/release/check/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm -workspace-path .
            moonc check -doctest-only ./2/lib.mbt -include-doctests -o ./target/wasm/release/check/2/2.blackbox_test.mi -pkg moonbitlang/core/2_blackbox_test -i ./target/wasm/release/check/2/2.mi:2 -i ./target/wasm/release/check/1/1.mi:1 -i ./target/wasm/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/2_blackbox_test:./2 -target wasm -blackbox-test -workspace-path .
            moonc check ./1/lib.mbt ./1/x.wasm.mbt -o ./target/wasm/release/check/1/1.whitebox_test.mi -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm -whitebox-test -workspace-path .
            moonc check -doctest-only ./1/lib.mbt -doctest-only ./1/x.wasm.mbt -include-doctests -o ./target/wasm/release/check/1/1.blackbox_test.mi -pkg moonbitlang/core/1_blackbox_test -i ./target/wasm/release/check/1/1.mi:1 -i ./target/wasm/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/1_blackbox_test:./1 -target wasm -blackbox-test -workspace-path .
            moonc check ./0/lib.mbt ./0/y.wasm.mbt ./0/y_wbtest.mbt ./0/y_wbtest.wasm.mbt -o ./target/wasm/release/check/0/0.whitebox_test.mi -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm -whitebox-test -workspace-path .
            moonc check ./0/lib.mbt ./0/y.wasm.mbt -o ./target/wasm/release/check/0/0.mi -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm -workspace-path .
            moonc check -doctest-only ./0/lib.mbt -doctest-only ./0/y.wasm.mbt -include-doctests -o ./target/wasm/release/check/0/0.blackbox_test.mi -pkg moonbitlang/core/0_blackbox_test -i ./target/wasm/release/check/0/0.mi:0 -i ./target/wasm/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/0_blackbox_test:./0 -target wasm -blackbox-test -workspace-path .
        "#]],
    );
    check(
        get_stdout(
            &dir,
            ["check", "--dry-run", "--target", "wasm-gc", "--sort-input"],
        ),
        expect![[r#"
            moonc check -o ./target/wasm-gc/release/check/prelude/prelude.mi -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target wasm-gc -workspace-path .
            moonc check -include-doctests -o ./target/wasm-gc/release/check/prelude/prelude.blackbox_test.mi -pkg moonbitlang/core/prelude_blackbox_test -i ./target/wasm-gc/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/prelude_blackbox_test:./prelude -target wasm-gc -blackbox-test -workspace-path .
            moonc check -o ./target/wasm-gc/release/check/coverage/coverage.mi -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target wasm-gc -workspace-path .
            moonc check -o ./target/wasm-gc/release/check/iter/iter.mi -pkg moonbitlang/core/iter -i ./target/wasm-gc/release/check/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm-gc -workspace-path .
            moonc check -include-doctests -o ./target/wasm-gc/release/check/iter/iter.blackbox_test.mi -pkg moonbitlang/core/iter_blackbox_test -i ./target/wasm-gc/release/check/iter/iter.mi:iter -i ./target/wasm-gc/release/check/coverage/coverage.mi:coverage -i ./target/wasm-gc/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/iter_blackbox_test:./iter -target wasm-gc -blackbox-test -workspace-path .
            moonc check -include-doctests -o ./target/wasm-gc/release/check/coverage/coverage.blackbox_test.mi -pkg moonbitlang/core/coverage_blackbox_test -i ./target/wasm-gc/release/check/coverage/coverage.mi:coverage -i ./target/wasm-gc/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/coverage_blackbox_test:./coverage -target wasm-gc -blackbox-test -workspace-path .
            moonc check -o ./target/wasm-gc/release/check/char/char.mi -pkg moonbitlang/core/char -i ./target/wasm-gc/release/check/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm-gc -workspace-path .
            moonc check -include-doctests -o ./target/wasm-gc/release/check/char/char.blackbox_test.mi -pkg moonbitlang/core/char_blackbox_test -i ./target/wasm-gc/release/check/char/char.mi:char -i ./target/wasm-gc/release/check/coverage/coverage.mi:coverage -i ./target/wasm-gc/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/char_blackbox_test:./char -target wasm-gc -blackbox-test -workspace-path .
            moonc check ./1/lib.mbt ./1/x.wasm-gc.mbt -o ./target/wasm-gc/release/check/1/1.mi -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -workspace-path .
            moonc check ./2/lib.mbt -o ./target/wasm-gc/release/check/2/2.mi -pkg moonbitlang/core/2 -i ./target/wasm-gc/release/check/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm-gc -workspace-path .
            moonc check -doctest-only ./2/lib.mbt -include-doctests -o ./target/wasm-gc/release/check/2/2.blackbox_test.mi -pkg moonbitlang/core/2_blackbox_test -i ./target/wasm-gc/release/check/2/2.mi:2 -i ./target/wasm-gc/release/check/1/1.mi:1 -i ./target/wasm-gc/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/2_blackbox_test:./2 -target wasm-gc -blackbox-test -workspace-path .
            moonc check ./1/lib.mbt ./1/x.wasm-gc.mbt ./1/x_wbtest.wasm-gc.mbt -o ./target/wasm-gc/release/check/1/1.whitebox_test.mi -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -whitebox-test -workspace-path .
            moonc check -doctest-only ./1/lib.mbt -doctest-only ./1/x.wasm-gc.mbt -include-doctests -o ./target/wasm-gc/release/check/1/1.blackbox_test.mi -pkg moonbitlang/core/1_blackbox_test -i ./target/wasm-gc/release/check/1/1.mi:1 -i ./target/wasm-gc/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/1_blackbox_test:./1 -target wasm-gc -blackbox-test -workspace-path .
            moonc check ./0/lib.mbt ./0/y.wasm-gc.mbt ./0/y_wbtest.mbt ./0/y_wbtest.wasm-gc.mbt -o ./target/wasm-gc/release/check/0/0.whitebox_test.mi -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -whitebox-test -workspace-path .
            moonc check ./0/lib.mbt ./0/y.wasm-gc.mbt -o ./target/wasm-gc/release/check/0/0.mi -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -workspace-path .
            moonc check -doctest-only ./0/lib.mbt -doctest-only ./0/y.wasm-gc.mbt -include-doctests -o ./target/wasm-gc/release/check/0/0.blackbox_test.mi -pkg moonbitlang/core/0_blackbox_test -i ./target/wasm-gc/release/check/0/0.mi:0 -i ./target/wasm-gc/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/0_blackbox_test:./0 -target wasm-gc -blackbox-test -workspace-path .
        "#]],
    );
    check(
        get_stdout(
            &dir,
            ["check", "--dry-run", "--target", "js", "--sort-input"],
        ),
        expect![[r#"
            moonc check -o ./target/js/release/check/prelude/prelude.mi -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target js -workspace-path .
            moonc check -include-doctests -o ./target/js/release/check/prelude/prelude.blackbox_test.mi -pkg moonbitlang/core/prelude_blackbox_test -i ./target/js/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/prelude_blackbox_test:./prelude -target js -blackbox-test -workspace-path .
            moonc check -o ./target/js/release/check/coverage/coverage.mi -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target js -workspace-path .
            moonc check -o ./target/js/release/check/iter/iter.mi -pkg moonbitlang/core/iter -i ./target/js/release/check/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target js -workspace-path .
            moonc check -include-doctests -o ./target/js/release/check/iter/iter.blackbox_test.mi -pkg moonbitlang/core/iter_blackbox_test -i ./target/js/release/check/iter/iter.mi:iter -i ./target/js/release/check/coverage/coverage.mi:coverage -i ./target/js/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/iter_blackbox_test:./iter -target js -blackbox-test -workspace-path .
            moonc check -include-doctests -o ./target/js/release/check/coverage/coverage.blackbox_test.mi -pkg moonbitlang/core/coverage_blackbox_test -i ./target/js/release/check/coverage/coverage.mi:coverage -i ./target/js/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/coverage_blackbox_test:./coverage -target js -blackbox-test -workspace-path .
            moonc check -o ./target/js/release/check/char/char.mi -pkg moonbitlang/core/char -i ./target/js/release/check/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target js -workspace-path .
            moonc check -include-doctests -o ./target/js/release/check/char/char.blackbox_test.mi -pkg moonbitlang/core/char_blackbox_test -i ./target/js/release/check/char/char.mi:char -i ./target/js/release/check/coverage/coverage.mi:coverage -i ./target/js/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/char_blackbox_test:./char -target js -blackbox-test -workspace-path .
            moonc check ./1/lib.mbt ./1/x.js.mbt -o ./target/js/release/check/1/1.mi -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target js -workspace-path .
            moonc check ./2/lib.mbt -o ./target/js/release/check/2/2.mi -pkg moonbitlang/core/2 -i ./target/js/release/check/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target js -workspace-path .
            moonc check -doctest-only ./2/lib.mbt -include-doctests -o ./target/js/release/check/2/2.blackbox_test.mi -pkg moonbitlang/core/2_blackbox_test -i ./target/js/release/check/2/2.mi:2 -i ./target/js/release/check/1/1.mi:1 -i ./target/js/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/2_blackbox_test:./2 -target js -blackbox-test -workspace-path .
            moonc check ./1/lib.mbt ./1/x.js.mbt -o ./target/js/release/check/1/1.whitebox_test.mi -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target js -whitebox-test -workspace-path .
            moonc check -doctest-only ./1/lib.mbt -doctest-only ./1/x.js.mbt -include-doctests -o ./target/js/release/check/1/1.blackbox_test.mi -pkg moonbitlang/core/1_blackbox_test -i ./target/js/release/check/1/1.mi:1 -i ./target/js/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/1_blackbox_test:./1 -target js -blackbox-test -workspace-path .
            moonc check ./0/lib.mbt ./0/y.js.mbt ./0/y_wbtest.js.mbt ./0/y_wbtest.mbt -o ./target/js/release/check/0/0.whitebox_test.mi -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target js -whitebox-test -workspace-path .
            moonc check ./0/lib.mbt ./0/y.js.mbt -o ./target/js/release/check/0/0.mi -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target js -workspace-path .
            moonc check -doctest-only ./0/lib.mbt -doctest-only ./0/y.js.mbt -include-doctests -o ./target/js/release/check/0/0.blackbox_test.mi -pkg moonbitlang/core/0_blackbox_test -i ./target/js/release/check/0/0.mi:0 -i ./target/js/release/check/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/0_blackbox_test:./0 -target js -blackbox-test -workspace-path .
        "#]],
    );

    check(
        get_stdout(&dir, ["build", "--dry-run", "--sort-input"]),
        expect![[r#"
            moonc build-package ./1/lib.mbt ./1/x.wasm-gc.mbt -o ./target/wasm-gc/release/build/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -workspace-path .
            moonc build-package ./2/lib.mbt -o ./target/wasm-gc/release/build/2/2.core -pkg moonbitlang/core/2 -i ./target/wasm-gc/release/build/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm-gc -workspace-path .
            moonc link-core ./target/wasm-gc/release/build/1/1.core ./target/wasm-gc/release/build/2/2.core -main moonbitlang/core/2 -o ./target/wasm-gc/release/build/2/2.wasm -pkg-config-path ./2/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/2:./2 -target wasm-gc
            moonc link-core ./target/wasm-gc/release/build/1/1.core -main moonbitlang/core/1 -o ./target/wasm-gc/release/build/1/1.wasm -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -target wasm-gc
            moonc build-package ./0/lib.mbt ./0/y.wasm-gc.mbt -o ./target/wasm-gc/release/build/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -workspace-path .
            moonc link-core ./target/wasm-gc/release/build/0/0.core -main moonbitlang/core/0 -o ./target/wasm-gc/release/build/0/0.wasm -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/0:./0 -target wasm-gc
        "#]],
    );
    check(
        get_stdout(
            &dir,
            ["build", "--dry-run", "--target", "wasm", "--sort-input"],
        ),
        expect![[r#"
            moonc build-package ./1/lib.mbt ./1/x.wasm.mbt -o ./target/wasm/release/build/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm -workspace-path .
            moonc build-package ./2/lib.mbt -o ./target/wasm/release/build/2/2.core -pkg moonbitlang/core/2 -i ./target/wasm/release/build/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm -workspace-path .
            moonc link-core ./target/wasm/release/build/1/1.core ./target/wasm/release/build/2/2.core -main moonbitlang/core/2 -o ./target/wasm/release/build/2/2.wasm -pkg-config-path ./2/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/2:./2 -target wasm
            moonc link-core ./target/wasm/release/build/1/1.core -main moonbitlang/core/1 -o ./target/wasm/release/build/1/1.wasm -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -target wasm
            moonc build-package ./0/lib.mbt ./0/y.wasm.mbt -o ./target/wasm/release/build/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm -workspace-path .
            moonc link-core ./target/wasm/release/build/0/0.core -main moonbitlang/core/0 -o ./target/wasm/release/build/0/0.wasm -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/0:./0 -target wasm
        "#]],
    );
    check(
        get_stdout(
            &dir,
            ["build", "--dry-run", "--target", "wasm-gc", "--sort-input"],
        ),
        expect![[r#"
            moonc build-package ./1/lib.mbt ./1/x.wasm-gc.mbt -o ./target/wasm-gc/release/build/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -workspace-path .
            moonc build-package ./2/lib.mbt -o ./target/wasm-gc/release/build/2/2.core -pkg moonbitlang/core/2 -i ./target/wasm-gc/release/build/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm-gc -workspace-path .
            moonc link-core ./target/wasm-gc/release/build/1/1.core ./target/wasm-gc/release/build/2/2.core -main moonbitlang/core/2 -o ./target/wasm-gc/release/build/2/2.wasm -pkg-config-path ./2/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/2:./2 -target wasm-gc
            moonc link-core ./target/wasm-gc/release/build/1/1.core -main moonbitlang/core/1 -o ./target/wasm-gc/release/build/1/1.wasm -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -target wasm-gc
            moonc build-package ./0/lib.mbt ./0/y.wasm-gc.mbt -o ./target/wasm-gc/release/build/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -workspace-path .
            moonc link-core ./target/wasm-gc/release/build/0/0.core -main moonbitlang/core/0 -o ./target/wasm-gc/release/build/0/0.wasm -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/0:./0 -target wasm-gc
        "#]],
    );
    check(
        get_stdout(
            &dir,
            ["build", "--dry-run", "--target", "js", "--sort-input"],
        ),
        expect![[r#"
            moonc build-package ./1/lib.mbt ./1/x.js.mbt -o ./target/js/release/build/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target js -workspace-path .
            moonc build-package ./2/lib.mbt -o ./target/js/release/build/2/2.core -pkg moonbitlang/core/2 -i ./target/js/release/build/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target js -workspace-path .
            moonc link-core ./target/js/release/build/1/1.core ./target/js/release/build/2/2.core -main moonbitlang/core/2 -o ./target/js/release/build/2/2.js -pkg-config-path ./2/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/2:./2 -target js
            moonc link-core ./target/js/release/build/1/1.core -main moonbitlang/core/1 -o ./target/js/release/build/1/1.js -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -target js
            moonc build-package ./0/lib.mbt ./0/y.js.mbt -o ./target/js/release/build/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target js -workspace-path .
            moonc link-core ./target/js/release/build/0/0.core -main moonbitlang/core/0 -o ./target/js/release/build/0/0.js -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/0:./0 -target js
        "#]],
    );

    check(
        get_stdout(&dir, ["test", "--dry-run", "--sort-input"]),
        expect![[r#"
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/prelude/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/prelude/__internal_test_info.json --target wasm-gc --pkg-name moonbitlang/core/prelude --driver-kind internal
            moonc build-package ./target/wasm-gc/debug/test/prelude/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/prelude/prelude.internal_test.core -pkg moonbitlang/core/prelude -is-main -pkg-sources moonbitlang/core/prelude:./prelude -target wasm-gc -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/prelude/prelude.internal_test.core -main moonbitlang/core/prelude -o ./target/wasm-gc/debug/test/prelude/prelude.internal_test.wasm -test-mode -pkg-config-path ./prelude/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package -o ./target/wasm-gc/debug/test/prelude/prelude.core -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target wasm-gc -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/prelude/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/prelude/__blackbox_test_info.json --target wasm-gc --pkg-name moonbitlang/core/prelude --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/prelude/__generated_driver_for_blackbox_test.mbt -o ./target/wasm-gc/debug/test/prelude/prelude.blackbox_test.core -pkg moonbitlang/core/prelude_blackbox_test -is-main -i ./target/wasm-gc/debug/test/prelude/prelude.mi:moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude_blackbox_test:./prelude -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/prelude/prelude.blackbox_test.core -main moonbitlang/core/prelude_blackbox_test -o ./target/wasm-gc/debug/test/prelude/prelude.blackbox_test.wasm -test-mode -pkg-config-path ./prelude/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/prelude_blackbox_test:./prelude -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package -o ./target/wasm-gc/debug/test/coverage/coverage.core -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target wasm-gc -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/iter/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/iter/__internal_test_info.json --target wasm-gc --pkg-name moonbitlang/core/iter --driver-kind internal
            moonc build-package ./target/wasm-gc/debug/test/iter/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/iter/iter.internal_test.core -pkg moonbitlang/core/iter -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm-gc -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/iter/iter.internal_test.core -main moonbitlang/core/iter -o ./target/wasm-gc/debug/test/iter/iter.internal_test.wasm -test-mode -pkg-config-path ./iter/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/iter:./iter -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package -o ./target/wasm-gc/debug/test/iter/iter.core -pkg moonbitlang/core/iter -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm-gc -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/iter/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/iter/__blackbox_test_info.json --target wasm-gc --pkg-name moonbitlang/core/iter --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/iter/__generated_driver_for_blackbox_test.mbt -o ./target/wasm-gc/debug/test/iter/iter.blackbox_test.core -pkg moonbitlang/core/iter_blackbox_test -is-main -i ./target/wasm-gc/debug/test/iter/iter.mi:iter -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/iter_blackbox_test:./iter -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/iter/iter.core ./target/wasm-gc/debug/test/iter/iter.blackbox_test.core -main moonbitlang/core/iter_blackbox_test -o ./target/wasm-gc/debug/test/iter/iter.blackbox_test.wasm -test-mode -pkg-config-path ./iter/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/iter:./iter -pkg-sources moonbitlang/core/iter_blackbox_test:./iter -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/coverage/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/coverage/__internal_test_info.json --target wasm-gc --pkg-name moonbitlang/core/coverage --driver-kind internal
            moonc build-package ./target/wasm-gc/debug/test/coverage/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/coverage/coverage.internal_test.core -pkg moonbitlang/core/coverage -is-main -pkg-sources moonbitlang/core/coverage:./coverage -target wasm-gc -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.internal_test.core -main moonbitlang/core/coverage -o ./target/wasm-gc/debug/test/coverage/coverage.internal_test.wasm -test-mode -pkg-config-path ./coverage/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/coverage/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/coverage/__blackbox_test_info.json --target wasm-gc --pkg-name moonbitlang/core/coverage --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/coverage/__generated_driver_for_blackbox_test.mbt -o ./target/wasm-gc/debug/test/coverage/coverage.blackbox_test.core -pkg moonbitlang/core/coverage_blackbox_test -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/coverage_blackbox_test:./coverage -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/coverage/coverage.blackbox_test.core -main moonbitlang/core/coverage_blackbox_test -o ./target/wasm-gc/debug/test/coverage/coverage.blackbox_test.wasm -test-mode -pkg-config-path ./coverage/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/coverage_blackbox_test:./coverage -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/char/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/char/__internal_test_info.json --target wasm-gc --pkg-name moonbitlang/core/char --driver-kind internal
            moonc build-package ./target/wasm-gc/debug/test/char/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/char/char.internal_test.core -pkg moonbitlang/core/char -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm-gc -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/char/char.internal_test.core -main moonbitlang/core/char -o ./target/wasm-gc/debug/test/char/char.internal_test.wasm -test-mode -pkg-config-path ./char/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/char:./char -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package -o ./target/wasm-gc/debug/test/char/char.core -pkg moonbitlang/core/char -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm-gc -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/char/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/char/__blackbox_test_info.json --target wasm-gc --pkg-name moonbitlang/core/char --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/char/__generated_driver_for_blackbox_test.mbt -o ./target/wasm-gc/debug/test/char/char.blackbox_test.core -pkg moonbitlang/core/char_blackbox_test -is-main -i ./target/wasm-gc/debug/test/char/char.mi:char -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/char_blackbox_test:./char -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/char/char.core ./target/wasm-gc/debug/test/char/char.blackbox_test.core -main moonbitlang/core/char_blackbox_test -o ./target/wasm-gc/debug/test/char/char.blackbox_test.wasm -test-mode -pkg-config-path ./char/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/char:./char -pkg-sources moonbitlang/core/char_blackbox_test:./char -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/2/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/2/__internal_test_info.json ./2/lib.mbt --target wasm-gc --pkg-name moonbitlang/core/2 --driver-kind internal
            moonc build-package ./1/lib.mbt ./1/x.wasm-gc.mbt -o ./target/wasm-gc/debug/test/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -g -O0 -source-map -workspace-path .
            moonc build-package ./2/lib.mbt ./target/wasm-gc/debug/test/2/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/2/2.internal_test.core -pkg moonbitlang/core/2 -is-main -i ./target/wasm-gc/debug/test/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm-gc -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/1/1.core ./target/wasm-gc/debug/test/2/2.internal_test.core -main moonbitlang/core/2 -o ./target/wasm-gc/debug/test/2/2.internal_test.wasm -test-mode -pkg-config-path ./2/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/2:./2 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package ./2/lib.mbt -o ./target/wasm-gc/debug/test/2/2.core -pkg moonbitlang/core/2 -i ./target/wasm-gc/debug/test/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm-gc -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/2/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/2/__blackbox_test_info.json --doctest-only ./2/lib.mbt --target wasm-gc --pkg-name moonbitlang/core/2 --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/2/__generated_driver_for_blackbox_test.mbt -doctest-only ./2/lib.mbt -o ./target/wasm-gc/debug/test/2/2.blackbox_test.core -pkg moonbitlang/core/2_blackbox_test -is-main -i ./target/wasm-gc/debug/test/2/2.mi:2 -i ./target/wasm-gc/debug/test/1/1.mi:1 -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/2_blackbox_test:./2 -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/1/1.core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/2/2.core ./target/wasm-gc/debug/test/2/2.blackbox_test.core -main moonbitlang/core/2_blackbox_test -o ./target/wasm-gc/debug/test/2/2.blackbox_test.wasm -test-mode -pkg-config-path ./2/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/2:./2 -pkg-sources moonbitlang/core/2_blackbox_test:./2 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/1/__generated_driver_for_whitebox_test.mbt --output-metadata ./target/wasm-gc/debug/test/1/__whitebox_test_info.json ./1/x_wbtest.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/1 --driver-kind whitebox
            moonc build-package ./1/lib.mbt ./1/x.wasm-gc.mbt ./1/x_wbtest.wasm-gc.mbt ./target/wasm-gc/debug/test/1/__generated_driver_for_whitebox_test.mbt -o ./target/wasm-gc/debug/test/1/1.whitebox_test.core -pkg moonbitlang/core/1 -is-main -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -g -O0 -source-map -whitebox-test -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/1/1.whitebox_test.core -main moonbitlang/core/1 -o ./target/wasm-gc/debug/test/1/1.whitebox_test.wasm -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/1/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/1/__internal_test_info.json ./1/lib.mbt ./1/x.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/1 --driver-kind internal
            moonc build-package ./1/lib.mbt ./1/x.wasm-gc.mbt ./target/wasm-gc/debug/test/1/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/1/1.internal_test.core -pkg moonbitlang/core/1 -is-main -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/1/1.internal_test.core -main moonbitlang/core/1 -o ./target/wasm-gc/debug/test/1/1.internal_test.wasm -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/1/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/1/__blackbox_test_info.json --doctest-only ./1/lib.mbt --doctest-only ./1/x.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/1 --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/1/__generated_driver_for_blackbox_test.mbt -doctest-only ./1/lib.mbt -doctest-only ./1/x.wasm-gc.mbt -o ./target/wasm-gc/debug/test/1/1.blackbox_test.core -pkg moonbitlang/core/1_blackbox_test -is-main -i ./target/wasm-gc/debug/test/1/1.mi:1 -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/1_blackbox_test:./1 -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/1/1.core ./target/wasm-gc/debug/test/1/1.blackbox_test.core -main moonbitlang/core/1_blackbox_test -o ./target/wasm-gc/debug/test/1/1.blackbox_test.wasm -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/1_blackbox_test:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/0/__generated_driver_for_whitebox_test.mbt --output-metadata ./target/wasm-gc/debug/test/0/__whitebox_test_info.json ./0/y_wbtest.mbt ./0/y_wbtest.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/0 --driver-kind whitebox
            moonc build-package ./0/lib.mbt ./0/y.wasm-gc.mbt ./0/y_wbtest.mbt ./0/y_wbtest.wasm-gc.mbt ./target/wasm-gc/debug/test/0/__generated_driver_for_whitebox_test.mbt -o ./target/wasm-gc/debug/test/0/0.whitebox_test.core -pkg moonbitlang/core/0 -is-main -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -g -O0 -source-map -whitebox-test -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/0/0.whitebox_test.core -main moonbitlang/core/0 -o ./target/wasm-gc/debug/test/0/0.whitebox_test.wasm -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/0:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/0/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/0/__internal_test_info.json ./0/lib.mbt ./0/y.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/0 --driver-kind internal
            moonc build-package ./0/lib.mbt ./0/y.wasm-gc.mbt ./target/wasm-gc/debug/test/0/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/0/0.internal_test.core -pkg moonbitlang/core/0 -is-main -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/0/0.internal_test.core -main moonbitlang/core/0 -o ./target/wasm-gc/debug/test/0/0.internal_test.wasm -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/0:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package ./0/lib.mbt ./0/y.wasm-gc.mbt -o ./target/wasm-gc/debug/test/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/0/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/0/__blackbox_test_info.json --doctest-only ./0/lib.mbt --doctest-only ./0/y.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/0 --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/0/__generated_driver_for_blackbox_test.mbt -doctest-only ./0/lib.mbt -doctest-only ./0/y.wasm-gc.mbt -o ./target/wasm-gc/debug/test/0/0.blackbox_test.core -pkg moonbitlang/core/0_blackbox_test -is-main -i ./target/wasm-gc/debug/test/0/0.mi:0 -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/0_blackbox_test:./0 -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/0/0.core ./target/wasm-gc/debug/test/0/0.blackbox_test.core -main moonbitlang/core/0_blackbox_test -o ./target/wasm-gc/debug/test/0/0.blackbox_test.wasm -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/0:./0 -pkg-sources moonbitlang/core/0_blackbox_test:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
        "#]],
    );
    check(
        get_stdout(
            &dir,
            ["test", "--dry-run", "--target", "wasm", "--sort-input"],
        ),
        expect![[r#"
            moon generate-test-driver --output-driver ./target/wasm/debug/test/prelude/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm/debug/test/prelude/__internal_test_info.json --target wasm --pkg-name moonbitlang/core/prelude --driver-kind internal
            moonc build-package ./target/wasm/debug/test/prelude/__generated_driver_for_internal_test.mbt -o ./target/wasm/debug/test/prelude/prelude.internal_test.core -pkg moonbitlang/core/prelude -is-main -pkg-sources moonbitlang/core/prelude:./prelude -target wasm -g -O0 -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/prelude/prelude.internal_test.core -main moonbitlang/core/prelude -o ./target/wasm/debug/test/prelude/prelude.internal_test.wasm -test-mode -pkg-config-path ./prelude/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moonc build-package -o ./target/wasm/debug/test/prelude/prelude.core -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target wasm -g -O0 -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm/debug/test/prelude/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm/debug/test/prelude/__blackbox_test_info.json --target wasm --pkg-name moonbitlang/core/prelude --driver-kind blackbox
            moonc build-package ./target/wasm/debug/test/prelude/__generated_driver_for_blackbox_test.mbt -o ./target/wasm/debug/test/prelude/prelude.blackbox_test.core -pkg moonbitlang/core/prelude_blackbox_test -is-main -i ./target/wasm/debug/test/prelude/prelude.mi:moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude_blackbox_test:./prelude -target wasm -g -O0 -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/prelude/prelude.core ./target/wasm/debug/test/prelude/prelude.blackbox_test.core -main moonbitlang/core/prelude_blackbox_test -o ./target/wasm/debug/test/prelude/prelude.blackbox_test.wasm -test-mode -pkg-config-path ./prelude/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/prelude_blackbox_test:./prelude -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moonc build-package -o ./target/wasm/debug/test/coverage/coverage.core -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target wasm -g -O0 -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm/debug/test/iter/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm/debug/test/iter/__internal_test_info.json --target wasm --pkg-name moonbitlang/core/iter --driver-kind internal
            moonc build-package ./target/wasm/debug/test/iter/__generated_driver_for_internal_test.mbt -o ./target/wasm/debug/test/iter/iter.internal_test.core -pkg moonbitlang/core/iter -is-main -i ./target/wasm/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm -g -O0 -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/coverage/coverage.core ./target/wasm/debug/test/iter/iter.internal_test.core -main moonbitlang/core/iter -o ./target/wasm/debug/test/iter/iter.internal_test.wasm -test-mode -pkg-config-path ./iter/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/iter:./iter -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moonc build-package -o ./target/wasm/debug/test/iter/iter.core -pkg moonbitlang/core/iter -i ./target/wasm/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm -g -O0 -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm/debug/test/iter/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm/debug/test/iter/__blackbox_test_info.json --target wasm --pkg-name moonbitlang/core/iter --driver-kind blackbox
            moonc build-package ./target/wasm/debug/test/iter/__generated_driver_for_blackbox_test.mbt -o ./target/wasm/debug/test/iter/iter.blackbox_test.core -pkg moonbitlang/core/iter_blackbox_test -is-main -i ./target/wasm/debug/test/iter/iter.mi:iter -i ./target/wasm/debug/test/coverage/coverage.mi:coverage -i ./target/wasm/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/iter_blackbox_test:./iter -target wasm -g -O0 -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/coverage/coverage.core ./target/wasm/debug/test/prelude/prelude.core ./target/wasm/debug/test/iter/iter.core ./target/wasm/debug/test/iter/iter.blackbox_test.core -main moonbitlang/core/iter_blackbox_test -o ./target/wasm/debug/test/iter/iter.blackbox_test.wasm -test-mode -pkg-config-path ./iter/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/iter:./iter -pkg-sources moonbitlang/core/iter_blackbox_test:./iter -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moon generate-test-driver --output-driver ./target/wasm/debug/test/coverage/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm/debug/test/coverage/__internal_test_info.json --target wasm --pkg-name moonbitlang/core/coverage --driver-kind internal
            moonc build-package ./target/wasm/debug/test/coverage/__generated_driver_for_internal_test.mbt -o ./target/wasm/debug/test/coverage/coverage.internal_test.core -pkg moonbitlang/core/coverage -is-main -pkg-sources moonbitlang/core/coverage:./coverage -target wasm -g -O0 -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/coverage/coverage.internal_test.core -main moonbitlang/core/coverage -o ./target/wasm/debug/test/coverage/coverage.internal_test.wasm -test-mode -pkg-config-path ./coverage/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moon generate-test-driver --output-driver ./target/wasm/debug/test/coverage/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm/debug/test/coverage/__blackbox_test_info.json --target wasm --pkg-name moonbitlang/core/coverage --driver-kind blackbox
            moonc build-package ./target/wasm/debug/test/coverage/__generated_driver_for_blackbox_test.mbt -o ./target/wasm/debug/test/coverage/coverage.blackbox_test.core -pkg moonbitlang/core/coverage_blackbox_test -is-main -i ./target/wasm/debug/test/coverage/coverage.mi:coverage -i ./target/wasm/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/coverage_blackbox_test:./coverage -target wasm -g -O0 -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/prelude/prelude.core ./target/wasm/debug/test/coverage/coverage.core ./target/wasm/debug/test/coverage/coverage.blackbox_test.core -main moonbitlang/core/coverage_blackbox_test -o ./target/wasm/debug/test/coverage/coverage.blackbox_test.wasm -test-mode -pkg-config-path ./coverage/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/coverage_blackbox_test:./coverage -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moon generate-test-driver --output-driver ./target/wasm/debug/test/char/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm/debug/test/char/__internal_test_info.json --target wasm --pkg-name moonbitlang/core/char --driver-kind internal
            moonc build-package ./target/wasm/debug/test/char/__generated_driver_for_internal_test.mbt -o ./target/wasm/debug/test/char/char.internal_test.core -pkg moonbitlang/core/char -is-main -i ./target/wasm/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm -g -O0 -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/coverage/coverage.core ./target/wasm/debug/test/char/char.internal_test.core -main moonbitlang/core/char -o ./target/wasm/debug/test/char/char.internal_test.wasm -test-mode -pkg-config-path ./char/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/char:./char -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moonc build-package -o ./target/wasm/debug/test/char/char.core -pkg moonbitlang/core/char -i ./target/wasm/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm -g -O0 -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm/debug/test/char/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm/debug/test/char/__blackbox_test_info.json --target wasm --pkg-name moonbitlang/core/char --driver-kind blackbox
            moonc build-package ./target/wasm/debug/test/char/__generated_driver_for_blackbox_test.mbt -o ./target/wasm/debug/test/char/char.blackbox_test.core -pkg moonbitlang/core/char_blackbox_test -is-main -i ./target/wasm/debug/test/char/char.mi:char -i ./target/wasm/debug/test/coverage/coverage.mi:coverage -i ./target/wasm/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/char_blackbox_test:./char -target wasm -g -O0 -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/coverage/coverage.core ./target/wasm/debug/test/prelude/prelude.core ./target/wasm/debug/test/char/char.core ./target/wasm/debug/test/char/char.blackbox_test.core -main moonbitlang/core/char_blackbox_test -o ./target/wasm/debug/test/char/char.blackbox_test.wasm -test-mode -pkg-config-path ./char/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/char:./char -pkg-sources moonbitlang/core/char_blackbox_test:./char -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moon generate-test-driver --output-driver ./target/wasm/debug/test/2/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm/debug/test/2/__internal_test_info.json ./2/lib.mbt --target wasm --pkg-name moonbitlang/core/2 --driver-kind internal
            moonc build-package ./1/lib.mbt ./1/x.wasm.mbt -o ./target/wasm/debug/test/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm -g -O0 -workspace-path .
            moonc build-package ./2/lib.mbt ./target/wasm/debug/test/2/__generated_driver_for_internal_test.mbt -o ./target/wasm/debug/test/2/2.internal_test.core -pkg moonbitlang/core/2 -is-main -i ./target/wasm/debug/test/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm -g -O0 -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/1/1.core ./target/wasm/debug/test/2/2.internal_test.core -main moonbitlang/core/2 -o ./target/wasm/debug/test/2/2.internal_test.wasm -test-mode -pkg-config-path ./2/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/2:./2 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moonc build-package ./2/lib.mbt -o ./target/wasm/debug/test/2/2.core -pkg moonbitlang/core/2 -i ./target/wasm/debug/test/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm -g -O0 -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm/debug/test/2/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm/debug/test/2/__blackbox_test_info.json --doctest-only ./2/lib.mbt --target wasm --pkg-name moonbitlang/core/2 --driver-kind blackbox
            moonc build-package ./target/wasm/debug/test/2/__generated_driver_for_blackbox_test.mbt -doctest-only ./2/lib.mbt -o ./target/wasm/debug/test/2/2.blackbox_test.core -pkg moonbitlang/core/2_blackbox_test -is-main -i ./target/wasm/debug/test/2/2.mi:2 -i ./target/wasm/debug/test/1/1.mi:1 -i ./target/wasm/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/2_blackbox_test:./2 -target wasm -g -O0 -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/1/1.core ./target/wasm/debug/test/prelude/prelude.core ./target/wasm/debug/test/2/2.core ./target/wasm/debug/test/2/2.blackbox_test.core -main moonbitlang/core/2_blackbox_test -o ./target/wasm/debug/test/2/2.blackbox_test.wasm -test-mode -pkg-config-path ./2/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/2:./2 -pkg-sources moonbitlang/core/2_blackbox_test:./2 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moon generate-test-driver --output-driver ./target/wasm/debug/test/1/__generated_driver_for_whitebox_test.mbt --output-metadata ./target/wasm/debug/test/1/__whitebox_test_info.json --target wasm --pkg-name moonbitlang/core/1 --driver-kind whitebox
            moonc build-package ./1/lib.mbt ./1/x.wasm.mbt ./target/wasm/debug/test/1/__generated_driver_for_whitebox_test.mbt -o ./target/wasm/debug/test/1/1.whitebox_test.core -pkg moonbitlang/core/1 -is-main -pkg-sources moonbitlang/core/1:./1 -target wasm -g -O0 -whitebox-test -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/1/1.whitebox_test.core -main moonbitlang/core/1 -o ./target/wasm/debug/test/1/1.whitebox_test.wasm -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moon generate-test-driver --output-driver ./target/wasm/debug/test/1/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm/debug/test/1/__internal_test_info.json ./1/lib.mbt ./1/x.wasm.mbt --target wasm --pkg-name moonbitlang/core/1 --driver-kind internal
            moonc build-package ./1/lib.mbt ./1/x.wasm.mbt ./target/wasm/debug/test/1/__generated_driver_for_internal_test.mbt -o ./target/wasm/debug/test/1/1.internal_test.core -pkg moonbitlang/core/1 -is-main -pkg-sources moonbitlang/core/1:./1 -target wasm -g -O0 -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/1/1.internal_test.core -main moonbitlang/core/1 -o ./target/wasm/debug/test/1/1.internal_test.wasm -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moon generate-test-driver --output-driver ./target/wasm/debug/test/1/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm/debug/test/1/__blackbox_test_info.json --doctest-only ./1/lib.mbt --doctest-only ./1/x.wasm.mbt --target wasm --pkg-name moonbitlang/core/1 --driver-kind blackbox
            moonc build-package ./target/wasm/debug/test/1/__generated_driver_for_blackbox_test.mbt -doctest-only ./1/lib.mbt -doctest-only ./1/x.wasm.mbt -o ./target/wasm/debug/test/1/1.blackbox_test.core -pkg moonbitlang/core/1_blackbox_test -is-main -i ./target/wasm/debug/test/1/1.mi:1 -i ./target/wasm/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/1_blackbox_test:./1 -target wasm -g -O0 -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/prelude/prelude.core ./target/wasm/debug/test/1/1.core ./target/wasm/debug/test/1/1.blackbox_test.core -main moonbitlang/core/1_blackbox_test -o ./target/wasm/debug/test/1/1.blackbox_test.wasm -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/1_blackbox_test:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moon generate-test-driver --output-driver ./target/wasm/debug/test/0/__generated_driver_for_whitebox_test.mbt --output-metadata ./target/wasm/debug/test/0/__whitebox_test_info.json ./0/y_wbtest.mbt ./0/y_wbtest.wasm.mbt --target wasm --pkg-name moonbitlang/core/0 --driver-kind whitebox
            moonc build-package ./0/lib.mbt ./0/y.wasm.mbt ./0/y_wbtest.mbt ./0/y_wbtest.wasm.mbt ./target/wasm/debug/test/0/__generated_driver_for_whitebox_test.mbt -o ./target/wasm/debug/test/0/0.whitebox_test.core -pkg moonbitlang/core/0 -is-main -pkg-sources moonbitlang/core/0:./0 -target wasm -g -O0 -whitebox-test -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/0/0.whitebox_test.core -main moonbitlang/core/0 -o ./target/wasm/debug/test/0/0.whitebox_test.wasm -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/0:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moon generate-test-driver --output-driver ./target/wasm/debug/test/0/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm/debug/test/0/__internal_test_info.json ./0/lib.mbt ./0/y.wasm.mbt --target wasm --pkg-name moonbitlang/core/0 --driver-kind internal
            moonc build-package ./0/lib.mbt ./0/y.wasm.mbt ./target/wasm/debug/test/0/__generated_driver_for_internal_test.mbt -o ./target/wasm/debug/test/0/0.internal_test.core -pkg moonbitlang/core/0 -is-main -pkg-sources moonbitlang/core/0:./0 -target wasm -g -O0 -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/0/0.internal_test.core -main moonbitlang/core/0 -o ./target/wasm/debug/test/0/0.internal_test.wasm -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/0:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
            moonc build-package ./0/lib.mbt ./0/y.wasm.mbt -o ./target/wasm/debug/test/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm -g -O0 -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm/debug/test/0/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm/debug/test/0/__blackbox_test_info.json --doctest-only ./0/lib.mbt --doctest-only ./0/y.wasm.mbt --target wasm --pkg-name moonbitlang/core/0 --driver-kind blackbox
            moonc build-package ./target/wasm/debug/test/0/__generated_driver_for_blackbox_test.mbt -doctest-only ./0/lib.mbt -doctest-only ./0/y.wasm.mbt -o ./target/wasm/debug/test/0/0.blackbox_test.core -pkg moonbitlang/core/0_blackbox_test -is-main -i ./target/wasm/debug/test/0/0.mi:0 -i ./target/wasm/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/0_blackbox_test:./0 -target wasm -g -O0 -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm/debug/test/prelude/prelude.core ./target/wasm/debug/test/0/0.core ./target/wasm/debug/test/0/0.blackbox_test.core -main moonbitlang/core/0_blackbox_test -o ./target/wasm/debug/test/0/0.blackbox_test.wasm -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/0:./0 -pkg-sources moonbitlang/core/0_blackbox_test:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm -g -O0
        "#]],
    );
    check(
        get_stdout(
            &dir,
            ["test", "--dry-run", "--target", "wasm-gc", "--sort-input"],
        ),
        expect![[r#"
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/prelude/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/prelude/__internal_test_info.json --target wasm-gc --pkg-name moonbitlang/core/prelude --driver-kind internal
            moonc build-package ./target/wasm-gc/debug/test/prelude/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/prelude/prelude.internal_test.core -pkg moonbitlang/core/prelude -is-main -pkg-sources moonbitlang/core/prelude:./prelude -target wasm-gc -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/prelude/prelude.internal_test.core -main moonbitlang/core/prelude -o ./target/wasm-gc/debug/test/prelude/prelude.internal_test.wasm -test-mode -pkg-config-path ./prelude/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package -o ./target/wasm-gc/debug/test/prelude/prelude.core -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target wasm-gc -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/prelude/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/prelude/__blackbox_test_info.json --target wasm-gc --pkg-name moonbitlang/core/prelude --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/prelude/__generated_driver_for_blackbox_test.mbt -o ./target/wasm-gc/debug/test/prelude/prelude.blackbox_test.core -pkg moonbitlang/core/prelude_blackbox_test -is-main -i ./target/wasm-gc/debug/test/prelude/prelude.mi:moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude_blackbox_test:./prelude -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/prelude/prelude.blackbox_test.core -main moonbitlang/core/prelude_blackbox_test -o ./target/wasm-gc/debug/test/prelude/prelude.blackbox_test.wasm -test-mode -pkg-config-path ./prelude/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/prelude_blackbox_test:./prelude -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package -o ./target/wasm-gc/debug/test/coverage/coverage.core -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target wasm-gc -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/iter/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/iter/__internal_test_info.json --target wasm-gc --pkg-name moonbitlang/core/iter --driver-kind internal
            moonc build-package ./target/wasm-gc/debug/test/iter/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/iter/iter.internal_test.core -pkg moonbitlang/core/iter -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm-gc -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/iter/iter.internal_test.core -main moonbitlang/core/iter -o ./target/wasm-gc/debug/test/iter/iter.internal_test.wasm -test-mode -pkg-config-path ./iter/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/iter:./iter -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package -o ./target/wasm-gc/debug/test/iter/iter.core -pkg moonbitlang/core/iter -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm-gc -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/iter/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/iter/__blackbox_test_info.json --target wasm-gc --pkg-name moonbitlang/core/iter --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/iter/__generated_driver_for_blackbox_test.mbt -o ./target/wasm-gc/debug/test/iter/iter.blackbox_test.core -pkg moonbitlang/core/iter_blackbox_test -is-main -i ./target/wasm-gc/debug/test/iter/iter.mi:iter -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/iter_blackbox_test:./iter -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/iter/iter.core ./target/wasm-gc/debug/test/iter/iter.blackbox_test.core -main moonbitlang/core/iter_blackbox_test -o ./target/wasm-gc/debug/test/iter/iter.blackbox_test.wasm -test-mode -pkg-config-path ./iter/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/iter:./iter -pkg-sources moonbitlang/core/iter_blackbox_test:./iter -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/coverage/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/coverage/__internal_test_info.json --target wasm-gc --pkg-name moonbitlang/core/coverage --driver-kind internal
            moonc build-package ./target/wasm-gc/debug/test/coverage/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/coverage/coverage.internal_test.core -pkg moonbitlang/core/coverage -is-main -pkg-sources moonbitlang/core/coverage:./coverage -target wasm-gc -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.internal_test.core -main moonbitlang/core/coverage -o ./target/wasm-gc/debug/test/coverage/coverage.internal_test.wasm -test-mode -pkg-config-path ./coverage/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/coverage/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/coverage/__blackbox_test_info.json --target wasm-gc --pkg-name moonbitlang/core/coverage --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/coverage/__generated_driver_for_blackbox_test.mbt -o ./target/wasm-gc/debug/test/coverage/coverage.blackbox_test.core -pkg moonbitlang/core/coverage_blackbox_test -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/coverage_blackbox_test:./coverage -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/coverage/coverage.blackbox_test.core -main moonbitlang/core/coverage_blackbox_test -o ./target/wasm-gc/debug/test/coverage/coverage.blackbox_test.wasm -test-mode -pkg-config-path ./coverage/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/coverage_blackbox_test:./coverage -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/char/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/char/__internal_test_info.json --target wasm-gc --pkg-name moonbitlang/core/char --driver-kind internal
            moonc build-package ./target/wasm-gc/debug/test/char/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/char/char.internal_test.core -pkg moonbitlang/core/char -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm-gc -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/char/char.internal_test.core -main moonbitlang/core/char -o ./target/wasm-gc/debug/test/char/char.internal_test.wasm -test-mode -pkg-config-path ./char/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/char:./char -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package -o ./target/wasm-gc/debug/test/char/char.core -pkg moonbitlang/core/char -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm-gc -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/char/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/char/__blackbox_test_info.json --target wasm-gc --pkg-name moonbitlang/core/char --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/char/__generated_driver_for_blackbox_test.mbt -o ./target/wasm-gc/debug/test/char/char.blackbox_test.core -pkg moonbitlang/core/char_blackbox_test -is-main -i ./target/wasm-gc/debug/test/char/char.mi:char -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/char_blackbox_test:./char -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/char/char.core ./target/wasm-gc/debug/test/char/char.blackbox_test.core -main moonbitlang/core/char_blackbox_test -o ./target/wasm-gc/debug/test/char/char.blackbox_test.wasm -test-mode -pkg-config-path ./char/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/char:./char -pkg-sources moonbitlang/core/char_blackbox_test:./char -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/2/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/2/__internal_test_info.json ./2/lib.mbt --target wasm-gc --pkg-name moonbitlang/core/2 --driver-kind internal
            moonc build-package ./1/lib.mbt ./1/x.wasm-gc.mbt -o ./target/wasm-gc/debug/test/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -g -O0 -source-map -workspace-path .
            moonc build-package ./2/lib.mbt ./target/wasm-gc/debug/test/2/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/2/2.internal_test.core -pkg moonbitlang/core/2 -is-main -i ./target/wasm-gc/debug/test/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm-gc -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/1/1.core ./target/wasm-gc/debug/test/2/2.internal_test.core -main moonbitlang/core/2 -o ./target/wasm-gc/debug/test/2/2.internal_test.wasm -test-mode -pkg-config-path ./2/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/2:./2 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package ./2/lib.mbt -o ./target/wasm-gc/debug/test/2/2.core -pkg moonbitlang/core/2 -i ./target/wasm-gc/debug/test/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm-gc -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/2/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/2/__blackbox_test_info.json --doctest-only ./2/lib.mbt --target wasm-gc --pkg-name moonbitlang/core/2 --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/2/__generated_driver_for_blackbox_test.mbt -doctest-only ./2/lib.mbt -o ./target/wasm-gc/debug/test/2/2.blackbox_test.core -pkg moonbitlang/core/2_blackbox_test -is-main -i ./target/wasm-gc/debug/test/2/2.mi:2 -i ./target/wasm-gc/debug/test/1/1.mi:1 -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/2_blackbox_test:./2 -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/1/1.core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/2/2.core ./target/wasm-gc/debug/test/2/2.blackbox_test.core -main moonbitlang/core/2_blackbox_test -o ./target/wasm-gc/debug/test/2/2.blackbox_test.wasm -test-mode -pkg-config-path ./2/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/2:./2 -pkg-sources moonbitlang/core/2_blackbox_test:./2 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/1/__generated_driver_for_whitebox_test.mbt --output-metadata ./target/wasm-gc/debug/test/1/__whitebox_test_info.json ./1/x_wbtest.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/1 --driver-kind whitebox
            moonc build-package ./1/lib.mbt ./1/x.wasm-gc.mbt ./1/x_wbtest.wasm-gc.mbt ./target/wasm-gc/debug/test/1/__generated_driver_for_whitebox_test.mbt -o ./target/wasm-gc/debug/test/1/1.whitebox_test.core -pkg moonbitlang/core/1 -is-main -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -g -O0 -source-map -whitebox-test -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/1/1.whitebox_test.core -main moonbitlang/core/1 -o ./target/wasm-gc/debug/test/1/1.whitebox_test.wasm -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/1/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/1/__internal_test_info.json ./1/lib.mbt ./1/x.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/1 --driver-kind internal
            moonc build-package ./1/lib.mbt ./1/x.wasm-gc.mbt ./target/wasm-gc/debug/test/1/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/1/1.internal_test.core -pkg moonbitlang/core/1 -is-main -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/1/1.internal_test.core -main moonbitlang/core/1 -o ./target/wasm-gc/debug/test/1/1.internal_test.wasm -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/1/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/1/__blackbox_test_info.json --doctest-only ./1/lib.mbt --doctest-only ./1/x.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/1 --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/1/__generated_driver_for_blackbox_test.mbt -doctest-only ./1/lib.mbt -doctest-only ./1/x.wasm-gc.mbt -o ./target/wasm-gc/debug/test/1/1.blackbox_test.core -pkg moonbitlang/core/1_blackbox_test -is-main -i ./target/wasm-gc/debug/test/1/1.mi:1 -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/1_blackbox_test:./1 -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/1/1.core ./target/wasm-gc/debug/test/1/1.blackbox_test.core -main moonbitlang/core/1_blackbox_test -o ./target/wasm-gc/debug/test/1/1.blackbox_test.wasm -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/1_blackbox_test:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/0/__generated_driver_for_whitebox_test.mbt --output-metadata ./target/wasm-gc/debug/test/0/__whitebox_test_info.json ./0/y_wbtest.mbt ./0/y_wbtest.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/0 --driver-kind whitebox
            moonc build-package ./0/lib.mbt ./0/y.wasm-gc.mbt ./0/y_wbtest.mbt ./0/y_wbtest.wasm-gc.mbt ./target/wasm-gc/debug/test/0/__generated_driver_for_whitebox_test.mbt -o ./target/wasm-gc/debug/test/0/0.whitebox_test.core -pkg moonbitlang/core/0 -is-main -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -g -O0 -source-map -whitebox-test -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/0/0.whitebox_test.core -main moonbitlang/core/0 -o ./target/wasm-gc/debug/test/0/0.whitebox_test.wasm -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/0:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/0/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/0/__internal_test_info.json ./0/lib.mbt ./0/y.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/0 --driver-kind internal
            moonc build-package ./0/lib.mbt ./0/y.wasm-gc.mbt ./target/wasm-gc/debug/test/0/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/0/0.internal_test.core -pkg moonbitlang/core/0 -is-main -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/0/0.internal_test.core -main moonbitlang/core/0 -o ./target/wasm-gc/debug/test/0/0.internal_test.wasm -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/0:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package ./0/lib.mbt ./0/y.wasm-gc.mbt -o ./target/wasm-gc/debug/test/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/0/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/0/__blackbox_test_info.json --doctest-only ./0/lib.mbt --doctest-only ./0/y.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/0 --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/0/__generated_driver_for_blackbox_test.mbt -doctest-only ./0/lib.mbt -doctest-only ./0/y.wasm-gc.mbt -o ./target/wasm-gc/debug/test/0/0.blackbox_test.core -pkg moonbitlang/core/0_blackbox_test -is-main -i ./target/wasm-gc/debug/test/0/0.mi:0 -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/0_blackbox_test:./0 -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/0/0.core ./target/wasm-gc/debug/test/0/0.blackbox_test.core -main moonbitlang/core/0_blackbox_test -o ./target/wasm-gc/debug/test/0/0.blackbox_test.wasm -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/0:./0 -pkg-sources moonbitlang/core/0_blackbox_test:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
        "#]],
    );
    check(
        get_stdout(
            &dir,
            ["test", "--dry-run", "--target", "js", "--sort-input"],
        ),
        expect![[r#"
            moon generate-test-driver --output-driver ./target/js/debug/test/prelude/__generated_driver_for_internal_test.mbt --output-metadata ./target/js/debug/test/prelude/__internal_test_info.json --target js --pkg-name moonbitlang/core/prelude --driver-kind internal
            moonc build-package ./target/js/debug/test/prelude/__generated_driver_for_internal_test.mbt -o ./target/js/debug/test/prelude/prelude.internal_test.core -pkg moonbitlang/core/prelude -is-main -pkg-sources moonbitlang/core/prelude:./prelude -target js -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/prelude/prelude.internal_test.core -main moonbitlang/core/prelude -o ./target/js/debug/test/prelude/prelude.internal_test.js -test-mode -pkg-config-path ./prelude/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moonc build-package -o ./target/js/debug/test/prelude/prelude.core -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target js -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/js/debug/test/prelude/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/js/debug/test/prelude/__blackbox_test_info.json --target js --pkg-name moonbitlang/core/prelude --driver-kind blackbox
            moonc build-package ./target/js/debug/test/prelude/__generated_driver_for_blackbox_test.mbt -o ./target/js/debug/test/prelude/prelude.blackbox_test.core -pkg moonbitlang/core/prelude_blackbox_test -is-main -i ./target/js/debug/test/prelude/prelude.mi:moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude_blackbox_test:./prelude -target js -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/prelude/prelude.core ./target/js/debug/test/prelude/prelude.blackbox_test.core -main moonbitlang/core/prelude_blackbox_test -o ./target/js/debug/test/prelude/prelude.blackbox_test.js -test-mode -pkg-config-path ./prelude/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/prelude_blackbox_test:./prelude -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moonc build-package -o ./target/js/debug/test/coverage/coverage.core -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target js -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/js/debug/test/iter/__generated_driver_for_internal_test.mbt --output-metadata ./target/js/debug/test/iter/__internal_test_info.json --target js --pkg-name moonbitlang/core/iter --driver-kind internal
            moonc build-package ./target/js/debug/test/iter/__generated_driver_for_internal_test.mbt -o ./target/js/debug/test/iter/iter.internal_test.core -pkg moonbitlang/core/iter -is-main -i ./target/js/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target js -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/coverage/coverage.core ./target/js/debug/test/iter/iter.internal_test.core -main moonbitlang/core/iter -o ./target/js/debug/test/iter/iter.internal_test.js -test-mode -pkg-config-path ./iter/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/iter:./iter -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moonc build-package -o ./target/js/debug/test/iter/iter.core -pkg moonbitlang/core/iter -i ./target/js/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target js -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/js/debug/test/iter/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/js/debug/test/iter/__blackbox_test_info.json --target js --pkg-name moonbitlang/core/iter --driver-kind blackbox
            moonc build-package ./target/js/debug/test/iter/__generated_driver_for_blackbox_test.mbt -o ./target/js/debug/test/iter/iter.blackbox_test.core -pkg moonbitlang/core/iter_blackbox_test -is-main -i ./target/js/debug/test/iter/iter.mi:iter -i ./target/js/debug/test/coverage/coverage.mi:coverage -i ./target/js/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/iter_blackbox_test:./iter -target js -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/coverage/coverage.core ./target/js/debug/test/prelude/prelude.core ./target/js/debug/test/iter/iter.core ./target/js/debug/test/iter/iter.blackbox_test.core -main moonbitlang/core/iter_blackbox_test -o ./target/js/debug/test/iter/iter.blackbox_test.js -test-mode -pkg-config-path ./iter/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/iter:./iter -pkg-sources moonbitlang/core/iter_blackbox_test:./iter -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/js/debug/test/coverage/__generated_driver_for_internal_test.mbt --output-metadata ./target/js/debug/test/coverage/__internal_test_info.json --target js --pkg-name moonbitlang/core/coverage --driver-kind internal
            moonc build-package ./target/js/debug/test/coverage/__generated_driver_for_internal_test.mbt -o ./target/js/debug/test/coverage/coverage.internal_test.core -pkg moonbitlang/core/coverage -is-main -pkg-sources moonbitlang/core/coverage:./coverage -target js -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/coverage/coverage.internal_test.core -main moonbitlang/core/coverage -o ./target/js/debug/test/coverage/coverage.internal_test.js -test-mode -pkg-config-path ./coverage/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/js/debug/test/coverage/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/js/debug/test/coverage/__blackbox_test_info.json --target js --pkg-name moonbitlang/core/coverage --driver-kind blackbox
            moonc build-package ./target/js/debug/test/coverage/__generated_driver_for_blackbox_test.mbt -o ./target/js/debug/test/coverage/coverage.blackbox_test.core -pkg moonbitlang/core/coverage_blackbox_test -is-main -i ./target/js/debug/test/coverage/coverage.mi:coverage -i ./target/js/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/coverage_blackbox_test:./coverage -target js -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/prelude/prelude.core ./target/js/debug/test/coverage/coverage.core ./target/js/debug/test/coverage/coverage.blackbox_test.core -main moonbitlang/core/coverage_blackbox_test -o ./target/js/debug/test/coverage/coverage.blackbox_test.js -test-mode -pkg-config-path ./coverage/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/coverage_blackbox_test:./coverage -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/js/debug/test/char/__generated_driver_for_internal_test.mbt --output-metadata ./target/js/debug/test/char/__internal_test_info.json --target js --pkg-name moonbitlang/core/char --driver-kind internal
            moonc build-package ./target/js/debug/test/char/__generated_driver_for_internal_test.mbt -o ./target/js/debug/test/char/char.internal_test.core -pkg moonbitlang/core/char -is-main -i ./target/js/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target js -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/coverage/coverage.core ./target/js/debug/test/char/char.internal_test.core -main moonbitlang/core/char -o ./target/js/debug/test/char/char.internal_test.js -test-mode -pkg-config-path ./char/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/char:./char -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moonc build-package -o ./target/js/debug/test/char/char.core -pkg moonbitlang/core/char -i ./target/js/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target js -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/js/debug/test/char/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/js/debug/test/char/__blackbox_test_info.json --target js --pkg-name moonbitlang/core/char --driver-kind blackbox
            moonc build-package ./target/js/debug/test/char/__generated_driver_for_blackbox_test.mbt -o ./target/js/debug/test/char/char.blackbox_test.core -pkg moonbitlang/core/char_blackbox_test -is-main -i ./target/js/debug/test/char/char.mi:char -i ./target/js/debug/test/coverage/coverage.mi:coverage -i ./target/js/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/char_blackbox_test:./char -target js -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/coverage/coverage.core ./target/js/debug/test/prelude/prelude.core ./target/js/debug/test/char/char.core ./target/js/debug/test/char/char.blackbox_test.core -main moonbitlang/core/char_blackbox_test -o ./target/js/debug/test/char/char.blackbox_test.js -test-mode -pkg-config-path ./char/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/char:./char -pkg-sources moonbitlang/core/char_blackbox_test:./char -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/js/debug/test/2/__generated_driver_for_internal_test.mbt --output-metadata ./target/js/debug/test/2/__internal_test_info.json ./2/lib.mbt --target js --pkg-name moonbitlang/core/2 --driver-kind internal
            moonc build-package ./1/lib.mbt ./1/x.js.mbt -o ./target/js/debug/test/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target js -g -O0 -source-map -workspace-path .
            moonc build-package ./2/lib.mbt ./target/js/debug/test/2/__generated_driver_for_internal_test.mbt -o ./target/js/debug/test/2/2.internal_test.core -pkg moonbitlang/core/2 -is-main -i ./target/js/debug/test/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target js -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/1/1.core ./target/js/debug/test/2/2.internal_test.core -main moonbitlang/core/2 -o ./target/js/debug/test/2/2.internal_test.js -test-mode -pkg-config-path ./2/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/2:./2 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moonc build-package ./2/lib.mbt -o ./target/js/debug/test/2/2.core -pkg moonbitlang/core/2 -i ./target/js/debug/test/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target js -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/js/debug/test/2/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/js/debug/test/2/__blackbox_test_info.json --doctest-only ./2/lib.mbt --target js --pkg-name moonbitlang/core/2 --driver-kind blackbox
            moonc build-package ./target/js/debug/test/2/__generated_driver_for_blackbox_test.mbt -doctest-only ./2/lib.mbt -o ./target/js/debug/test/2/2.blackbox_test.core -pkg moonbitlang/core/2_blackbox_test -is-main -i ./target/js/debug/test/2/2.mi:2 -i ./target/js/debug/test/1/1.mi:1 -i ./target/js/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/2_blackbox_test:./2 -target js -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/1/1.core ./target/js/debug/test/prelude/prelude.core ./target/js/debug/test/2/2.core ./target/js/debug/test/2/2.blackbox_test.core -main moonbitlang/core/2_blackbox_test -o ./target/js/debug/test/2/2.blackbox_test.js -test-mode -pkg-config-path ./2/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/2:./2 -pkg-sources moonbitlang/core/2_blackbox_test:./2 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/js/debug/test/1/__generated_driver_for_whitebox_test.mbt --output-metadata ./target/js/debug/test/1/__whitebox_test_info.json --target js --pkg-name moonbitlang/core/1 --driver-kind whitebox
            moonc build-package ./1/lib.mbt ./1/x.js.mbt ./target/js/debug/test/1/__generated_driver_for_whitebox_test.mbt -o ./target/js/debug/test/1/1.whitebox_test.core -pkg moonbitlang/core/1 -is-main -pkg-sources moonbitlang/core/1:./1 -target js -g -O0 -source-map -whitebox-test -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/1/1.whitebox_test.core -main moonbitlang/core/1 -o ./target/js/debug/test/1/1.whitebox_test.js -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/js/debug/test/1/__generated_driver_for_internal_test.mbt --output-metadata ./target/js/debug/test/1/__internal_test_info.json ./1/lib.mbt ./1/x.js.mbt --target js --pkg-name moonbitlang/core/1 --driver-kind internal
            moonc build-package ./1/lib.mbt ./1/x.js.mbt ./target/js/debug/test/1/__generated_driver_for_internal_test.mbt -o ./target/js/debug/test/1/1.internal_test.core -pkg moonbitlang/core/1 -is-main -pkg-sources moonbitlang/core/1:./1 -target js -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/1/1.internal_test.core -main moonbitlang/core/1 -o ./target/js/debug/test/1/1.internal_test.js -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/1:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/js/debug/test/1/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/js/debug/test/1/__blackbox_test_info.json --doctest-only ./1/lib.mbt --doctest-only ./1/x.js.mbt --target js --pkg-name moonbitlang/core/1 --driver-kind blackbox
            moonc build-package ./target/js/debug/test/1/__generated_driver_for_blackbox_test.mbt -doctest-only ./1/lib.mbt -doctest-only ./1/x.js.mbt -o ./target/js/debug/test/1/1.blackbox_test.core -pkg moonbitlang/core/1_blackbox_test -is-main -i ./target/js/debug/test/1/1.mi:1 -i ./target/js/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/1_blackbox_test:./1 -target js -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/prelude/prelude.core ./target/js/debug/test/1/1.core ./target/js/debug/test/1/1.blackbox_test.core -main moonbitlang/core/1_blackbox_test -o ./target/js/debug/test/1/1.blackbox_test.js -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/1_blackbox_test:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/js/debug/test/0/__generated_driver_for_whitebox_test.mbt --output-metadata ./target/js/debug/test/0/__whitebox_test_info.json ./0/y_wbtest.js.mbt ./0/y_wbtest.mbt --target js --pkg-name moonbitlang/core/0 --driver-kind whitebox
            moonc build-package ./0/lib.mbt ./0/y.js.mbt ./0/y_wbtest.js.mbt ./0/y_wbtest.mbt ./target/js/debug/test/0/__generated_driver_for_whitebox_test.mbt -o ./target/js/debug/test/0/0.whitebox_test.core -pkg moonbitlang/core/0 -is-main -pkg-sources moonbitlang/core/0:./0 -target js -g -O0 -source-map -whitebox-test -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/0/0.whitebox_test.core -main moonbitlang/core/0 -o ./target/js/debug/test/0/0.whitebox_test.js -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/0:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/js/debug/test/0/__generated_driver_for_internal_test.mbt --output-metadata ./target/js/debug/test/0/__internal_test_info.json ./0/lib.mbt ./0/y.js.mbt --target js --pkg-name moonbitlang/core/0 --driver-kind internal
            moonc build-package ./0/lib.mbt ./0/y.js.mbt ./target/js/debug/test/0/__generated_driver_for_internal_test.mbt -o ./target/js/debug/test/0/0.internal_test.core -pkg moonbitlang/core/0 -is-main -pkg-sources moonbitlang/core/0:./0 -target js -g -O0 -source-map -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/0/0.internal_test.core -main moonbitlang/core/0 -o ./target/js/debug/test/0/0.internal_test.js -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/0:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
            moonc build-package ./0/lib.mbt ./0/y.js.mbt -o ./target/js/debug/test/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target js -g -O0 -source-map -workspace-path .
            moon generate-test-driver --output-driver ./target/js/debug/test/0/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/js/debug/test/0/__blackbox_test_info.json --doctest-only ./0/lib.mbt --doctest-only ./0/y.js.mbt --target js --pkg-name moonbitlang/core/0 --driver-kind blackbox
            moonc build-package ./target/js/debug/test/0/__generated_driver_for_blackbox_test.mbt -doctest-only ./0/lib.mbt -doctest-only ./0/y.js.mbt -o ./target/js/debug/test/0/0.blackbox_test.core -pkg moonbitlang/core/0_blackbox_test -is-main -i ./target/js/debug/test/0/0.mi:0 -i ./target/js/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/0_blackbox_test:./0 -target js -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/js/debug/test/prelude/prelude.core ./target/js/debug/test/0/0.core ./target/js/debug/test/0/0.blackbox_test.core -main moonbitlang/core/0_blackbox_test -o ./target/js/debug/test/0/0.blackbox_test.js -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/0:./0 -pkg-sources moonbitlang/core/0_blackbox_test:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -js-format cjs -no-dts -target js -g -O0 -source-map
        "#]],
    );
    check(
        get_stdout(
            &dir,
            ["test", "--dry-run", "--enable-coverage", "--sort-input"],
        ),
        expect![[r#"
            moonc build-package -o ./target/wasm-gc/debug/test/coverage/coverage.core -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target wasm-gc -g -O0 -source-map -enable-coverage -coverage-package-override=@self -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/prelude/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/prelude/__internal_test_info.json --target wasm-gc --pkg-name moonbitlang/core/prelude --enable-coverage --driver-kind internal
            moonc build-package ./target/wasm-gc/debug/test/prelude/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/prelude/prelude.internal_test.core -pkg moonbitlang/core/prelude -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/prelude:./prelude -target wasm-gc -g -O0 -source-map -enable-coverage -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/prelude/prelude.internal_test.core -main moonbitlang/core/prelude -o ./target/wasm-gc/debug/test/prelude/prelude.internal_test.wasm -test-mode -pkg-config-path ./prelude/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/prelude:./prelude -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package -o ./target/wasm-gc/debug/test/prelude/prelude.core -pkg moonbitlang/core/prelude -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/prelude:./prelude -target wasm-gc -g -O0 -source-map -enable-coverage -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/prelude/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/prelude/__blackbox_test_info.json --target wasm-gc --pkg-name moonbitlang/core/prelude --enable-coverage --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/prelude/__generated_driver_for_blackbox_test.mbt -o ./target/wasm-gc/debug/test/prelude/prelude.blackbox_test.core -pkg moonbitlang/core/prelude_blackbox_test -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/prelude/prelude.mi:moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude_blackbox_test:./prelude -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/prelude/prelude.blackbox_test.core -main moonbitlang/core/prelude_blackbox_test -o ./target/wasm-gc/debug/test/prelude/prelude.blackbox_test.wasm -test-mode -pkg-config-path ./prelude/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/prelude_blackbox_test:./prelude -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/iter/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/iter/__internal_test_info.json --target wasm-gc --pkg-name moonbitlang/core/iter --enable-coverage --driver-kind internal
            moonc build-package ./target/wasm-gc/debug/test/iter/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/iter/iter.internal_test.core -pkg moonbitlang/core/iter -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm-gc -g -O0 -source-map -enable-coverage -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/iter/iter.internal_test.core -main moonbitlang/core/iter -o ./target/wasm-gc/debug/test/iter/iter.internal_test.wasm -test-mode -pkg-config-path ./iter/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/iter:./iter -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package -o ./target/wasm-gc/debug/test/iter/iter.core -pkg moonbitlang/core/iter -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm-gc -g -O0 -source-map -enable-coverage -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/iter/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/iter/__blackbox_test_info.json --target wasm-gc --pkg-name moonbitlang/core/iter --enable-coverage --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/iter/__generated_driver_for_blackbox_test.mbt -o ./target/wasm-gc/debug/test/iter/iter.blackbox_test.core -pkg moonbitlang/core/iter_blackbox_test -is-main -i ./target/wasm-gc/debug/test/iter/iter.mi:iter -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/iter_blackbox_test:./iter -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/iter/iter.core ./target/wasm-gc/debug/test/iter/iter.blackbox_test.core -main moonbitlang/core/iter_blackbox_test -o ./target/wasm-gc/debug/test/iter/iter.blackbox_test.wasm -test-mode -pkg-config-path ./iter/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/iter:./iter -pkg-sources moonbitlang/core/iter_blackbox_test:./iter -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/coverage/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/coverage/__internal_test_info.json --target wasm-gc --pkg-name moonbitlang/core/coverage --enable-coverage --coverage-package-override=@self --driver-kind internal
            moonc build-package ./target/wasm-gc/debug/test/coverage/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/coverage/coverage.internal_test.core -pkg moonbitlang/core/coverage -is-main -pkg-sources moonbitlang/core/coverage:./coverage -target wasm-gc -g -O0 -source-map -enable-coverage -coverage-package-override=@self -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.internal_test.core -main moonbitlang/core/coverage -o ./target/wasm-gc/debug/test/coverage/coverage.internal_test.wasm -test-mode -pkg-config-path ./coverage/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/coverage/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/coverage/__blackbox_test_info.json --target wasm-gc --pkg-name moonbitlang/core/coverage --enable-coverage --coverage-package-override=@self --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/coverage/__generated_driver_for_blackbox_test.mbt -o ./target/wasm-gc/debug/test/coverage/coverage.blackbox_test.core -pkg moonbitlang/core/coverage_blackbox_test -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/coverage_blackbox_test:./coverage -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/coverage/coverage.blackbox_test.core -main moonbitlang/core/coverage_blackbox_test -o ./target/wasm-gc/debug/test/coverage/coverage.blackbox_test.wasm -test-mode -pkg-config-path ./coverage/moon.pkg.json -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/coverage_blackbox_test:./coverage -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/char/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/char/__internal_test_info.json --target wasm-gc --pkg-name moonbitlang/core/char --enable-coverage --driver-kind internal
            moonc build-package ./target/wasm-gc/debug/test/char/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/char/char.internal_test.core -pkg moonbitlang/core/char -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm-gc -g -O0 -source-map -enable-coverage -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/char/char.internal_test.core -main moonbitlang/core/char -o ./target/wasm-gc/debug/test/char/char.internal_test.wasm -test-mode -pkg-config-path ./char/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/char:./char -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package -o ./target/wasm-gc/debug/test/char/char.core -pkg moonbitlang/core/char -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm-gc -g -O0 -source-map -enable-coverage -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/char/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/char/__blackbox_test_info.json --target wasm-gc --pkg-name moonbitlang/core/char --enable-coverage --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/char/__generated_driver_for_blackbox_test.mbt -o ./target/wasm-gc/debug/test/char/char.blackbox_test.core -pkg moonbitlang/core/char_blackbox_test -is-main -i ./target/wasm-gc/debug/test/char/char.mi:char -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/char_blackbox_test:./char -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/char/char.core ./target/wasm-gc/debug/test/char/char.blackbox_test.core -main moonbitlang/core/char_blackbox_test -o ./target/wasm-gc/debug/test/char/char.blackbox_test.wasm -test-mode -pkg-config-path ./char/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/char:./char -pkg-sources moonbitlang/core/char_blackbox_test:./char -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/2/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/2/__internal_test_info.json ./2/lib.mbt --target wasm-gc --pkg-name moonbitlang/core/2 --enable-coverage --driver-kind internal
            moonc build-package ./1/lib.mbt ./1/x.wasm-gc.mbt -o ./target/wasm-gc/debug/test/1/1.core -pkg moonbitlang/core/1 -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -g -O0 -source-map -enable-coverage -workspace-path .
            moonc build-package ./2/lib.mbt ./target/wasm-gc/debug/test/2/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/2/2.internal_test.core -pkg moonbitlang/core/2 -is-main -i ./target/wasm-gc/debug/test/1/1.mi:1 -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/2:./2 -target wasm-gc -g -O0 -source-map -enable-coverage -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/1/1.core ./target/wasm-gc/debug/test/2/2.internal_test.core -main moonbitlang/core/2 -o ./target/wasm-gc/debug/test/2/2.internal_test.wasm -test-mode -pkg-config-path ./2/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/2:./2 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package ./2/lib.mbt -o ./target/wasm-gc/debug/test/2/2.core -pkg moonbitlang/core/2 -i ./target/wasm-gc/debug/test/1/1.mi:1 -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/2:./2 -target wasm-gc -g -O0 -source-map -enable-coverage -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/2/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/2/__blackbox_test_info.json --doctest-only ./2/lib.mbt --target wasm-gc --pkg-name moonbitlang/core/2 --enable-coverage --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/2/__generated_driver_for_blackbox_test.mbt -doctest-only ./2/lib.mbt -o ./target/wasm-gc/debug/test/2/2.blackbox_test.core -pkg moonbitlang/core/2_blackbox_test -is-main -i ./target/wasm-gc/debug/test/2/2.mi:2 -i ./target/wasm-gc/debug/test/1/1.mi:1 -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/2_blackbox_test:./2 -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/1/1.core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/2/2.core ./target/wasm-gc/debug/test/2/2.blackbox_test.core -main moonbitlang/core/2_blackbox_test -o ./target/wasm-gc/debug/test/2/2.blackbox_test.wasm -test-mode -pkg-config-path ./2/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/2:./2 -pkg-sources moonbitlang/core/2_blackbox_test:./2 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/1/__generated_driver_for_whitebox_test.mbt --output-metadata ./target/wasm-gc/debug/test/1/__whitebox_test_info.json ./1/x_wbtest.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/1 --enable-coverage --driver-kind whitebox
            moonc build-package ./1/lib.mbt ./1/x.wasm-gc.mbt ./1/x_wbtest.wasm-gc.mbt ./target/wasm-gc/debug/test/1/__generated_driver_for_whitebox_test.mbt -o ./target/wasm-gc/debug/test/1/1.whitebox_test.core -pkg moonbitlang/core/1 -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -g -O0 -source-map -enable-coverage -whitebox-test -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/1/1.whitebox_test.core -main moonbitlang/core/1 -o ./target/wasm-gc/debug/test/1/1.whitebox_test.wasm -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/1:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/1/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/1/__internal_test_info.json ./1/lib.mbt ./1/x.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/1 --enable-coverage --driver-kind internal
            moonc build-package ./1/lib.mbt ./1/x.wasm-gc.mbt ./target/wasm-gc/debug/test/1/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/1/1.internal_test.core -pkg moonbitlang/core/1 -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/1:./1 -target wasm-gc -g -O0 -source-map -enable-coverage -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/1/1.internal_test.core -main moonbitlang/core/1 -o ./target/wasm-gc/debug/test/1/1.internal_test.wasm -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/1:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/1/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/1/__blackbox_test_info.json --doctest-only ./1/lib.mbt --doctest-only ./1/x.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/1 --enable-coverage --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/1/__generated_driver_for_blackbox_test.mbt -doctest-only ./1/lib.mbt -doctest-only ./1/x.wasm-gc.mbt -o ./target/wasm-gc/debug/test/1/1.blackbox_test.core -pkg moonbitlang/core/1_blackbox_test -is-main -i ./target/wasm-gc/debug/test/1/1.mi:1 -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/1_blackbox_test:./1 -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/1/1.core ./target/wasm-gc/debug/test/1/1.blackbox_test.core -main moonbitlang/core/1_blackbox_test -o ./target/wasm-gc/debug/test/1/1.blackbox_test.wasm -test-mode -pkg-config-path ./1/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/1:./1 -pkg-sources moonbitlang/core/1_blackbox_test:./1 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/0/__generated_driver_for_whitebox_test.mbt --output-metadata ./target/wasm-gc/debug/test/0/__whitebox_test_info.json ./0/y_wbtest.mbt ./0/y_wbtest.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/0 --enable-coverage --driver-kind whitebox
            moonc build-package ./0/lib.mbt ./0/y.wasm-gc.mbt ./0/y_wbtest.mbt ./0/y_wbtest.wasm-gc.mbt ./target/wasm-gc/debug/test/0/__generated_driver_for_whitebox_test.mbt -o ./target/wasm-gc/debug/test/0/0.whitebox_test.core -pkg moonbitlang/core/0 -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -g -O0 -source-map -enable-coverage -whitebox-test -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/0/0.whitebox_test.core -main moonbitlang/core/0 -o ./target/wasm-gc/debug/test/0/0.whitebox_test.wasm -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/0:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/0/__generated_driver_for_internal_test.mbt --output-metadata ./target/wasm-gc/debug/test/0/__internal_test_info.json ./0/lib.mbt ./0/y.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/0 --enable-coverage --driver-kind internal
            moonc build-package ./0/lib.mbt ./0/y.wasm-gc.mbt ./target/wasm-gc/debug/test/0/__generated_driver_for_internal_test.mbt -o ./target/wasm-gc/debug/test/0/0.internal_test.core -pkg moonbitlang/core/0 -is-main -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -g -O0 -source-map -enable-coverage -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/0/0.internal_test.core -main moonbitlang/core/0 -o ./target/wasm-gc/debug/test/0/0.internal_test.wasm -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/0:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
            moonc build-package ./0/lib.mbt ./0/y.wasm-gc.mbt -o ./target/wasm-gc/debug/test/0/0.core -pkg moonbitlang/core/0 -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/0:./0 -target wasm-gc -g -O0 -source-map -enable-coverage -workspace-path .
            moon generate-test-driver --output-driver ./target/wasm-gc/debug/test/0/__generated_driver_for_blackbox_test.mbt --output-metadata ./target/wasm-gc/debug/test/0/__blackbox_test_info.json --doctest-only ./0/lib.mbt --doctest-only ./0/y.wasm-gc.mbt --target wasm-gc --pkg-name moonbitlang/core/0 --enable-coverage --driver-kind blackbox
            moonc build-package ./target/wasm-gc/debug/test/0/__generated_driver_for_blackbox_test.mbt -doctest-only ./0/lib.mbt -doctest-only ./0/y.wasm-gc.mbt -o ./target/wasm-gc/debug/test/0/0.blackbox_test.core -pkg moonbitlang/core/0_blackbox_test -is-main -i ./target/wasm-gc/debug/test/0/0.mi:0 -i ./target/wasm-gc/debug/test/coverage/coverage.mi:coverage -i ./target/wasm-gc/debug/test/prelude/prelude.mi:prelude -pkg-sources moonbitlang/core/0_blackbox_test:./0 -target wasm-gc -g -O0 -source-map -blackbox-test -include-doctests -no-mi -test-mode -workspace-path .
            moonc link-core ./target/wasm-gc/debug/test/coverage/coverage.core ./target/wasm-gc/debug/test/prelude/prelude.core ./target/wasm-gc/debug/test/0/0.core ./target/wasm-gc/debug/test/0/0.blackbox_test.core -main moonbitlang/core/0_blackbox_test -o ./target/wasm-gc/debug/test/0/0.blackbox_test.wasm -test-mode -pkg-config-path ./0/moon.pkg.json -pkg-sources moonbitlang/core/coverage:./coverage -pkg-sources moonbitlang/core/prelude:./prelude -pkg-sources moonbitlang/core/0:./0 -pkg-sources moonbitlang/core/0_blackbox_test:./0 -exported_functions moonbit_test_driver_internal_execute,moonbit_test_driver_finish -target wasm-gc -g -O0 -source-map
        "#]],
    );
    check(
        get_stdout(&dir, ["bundle", "--dry-run", "--sort-input"]),
        expect![[r#"
            moonc build-package -o ./target/wasm-gc/release/bundle/prelude/prelude.core -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target wasm-gc
            moonc build-package -o ./target/wasm-gc/release/bundle/coverage/coverage.core -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target wasm-gc
            moonc build-package -o ./target/wasm-gc/release/bundle/iter/iter.core -pkg moonbitlang/core/iter -i ./target/wasm-gc/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm-gc
            moonc build-package -o ./target/wasm-gc/release/bundle/char/char.core -pkg moonbitlang/core/char -i ./target/wasm-gc/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm-gc
            moonc build-package ./1/lib.mbt ./1/x.wasm-gc.mbt -o ./target/wasm-gc/release/bundle/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm-gc
            moonc build-package ./2/lib.mbt -o ./target/wasm-gc/release/bundle/2/2.core -pkg moonbitlang/core/2 -i ./target/wasm-gc/release/bundle/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm-gc
            moonc build-package ./0/lib.mbt ./0/y.wasm-gc.mbt -o ./target/wasm-gc/release/bundle/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm-gc
            moonc bundle-core ./target/wasm-gc/release/bundle/0/0.core ./target/wasm-gc/release/bundle/1/1.core ./target/wasm-gc/release/bundle/2/2.core ./target/wasm-gc/release/bundle/coverage/coverage.core ./target/wasm-gc/release/bundle/char/char.core ./target/wasm-gc/release/bundle/iter/iter.core ./target/wasm-gc/release/bundle/prelude/prelude.core -o ./target/wasm-gc/release/bundle/core.core
        "#]],
    );
    check(
        get_stdout(
            &dir,
            ["bundle", "--dry-run", "--target", "wasm", "--sort-input"],
        ),
        expect![[r#"
            moonc build-package -o ./target/wasm/release/bundle/prelude/prelude.core -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target wasm
            moonc build-package -o ./target/wasm/release/bundle/coverage/coverage.core -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target wasm
            moonc build-package -o ./target/wasm/release/bundle/iter/iter.core -pkg moonbitlang/core/iter -i ./target/wasm/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm
            moonc build-package -o ./target/wasm/release/bundle/char/char.core -pkg moonbitlang/core/char -i ./target/wasm/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm
            moonc build-package ./1/lib.mbt ./1/x.wasm.mbt -o ./target/wasm/release/bundle/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm
            moonc build-package ./2/lib.mbt -o ./target/wasm/release/bundle/2/2.core -pkg moonbitlang/core/2 -i ./target/wasm/release/bundle/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm
            moonc build-package ./0/lib.mbt ./0/y.wasm.mbt -o ./target/wasm/release/bundle/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm
            moonc bundle-core ./target/wasm/release/bundle/0/0.core ./target/wasm/release/bundle/1/1.core ./target/wasm/release/bundle/2/2.core ./target/wasm/release/bundle/coverage/coverage.core ./target/wasm/release/bundle/char/char.core ./target/wasm/release/bundle/iter/iter.core ./target/wasm/release/bundle/prelude/prelude.core -o ./target/wasm/release/bundle/core.core
        "#]],
    );
    check(
        get_stdout(
            &dir,
            ["bundle", "--dry-run", "--target", "wasm-gc", "--sort-input"],
        ),
        expect![[r#"
            moonc build-package -o ./target/wasm-gc/release/bundle/prelude/prelude.core -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target wasm-gc
            moonc build-package -o ./target/wasm-gc/release/bundle/coverage/coverage.core -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target wasm-gc
            moonc build-package -o ./target/wasm-gc/release/bundle/iter/iter.core -pkg moonbitlang/core/iter -i ./target/wasm-gc/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm-gc
            moonc build-package -o ./target/wasm-gc/release/bundle/char/char.core -pkg moonbitlang/core/char -i ./target/wasm-gc/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm-gc
            moonc build-package ./1/lib.mbt ./1/x.wasm-gc.mbt -o ./target/wasm-gc/release/bundle/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm-gc
            moonc build-package ./2/lib.mbt -o ./target/wasm-gc/release/bundle/2/2.core -pkg moonbitlang/core/2 -i ./target/wasm-gc/release/bundle/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm-gc
            moonc build-package ./0/lib.mbt ./0/y.wasm-gc.mbt -o ./target/wasm-gc/release/bundle/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm-gc
            moonc bundle-core ./target/wasm-gc/release/bundle/0/0.core ./target/wasm-gc/release/bundle/1/1.core ./target/wasm-gc/release/bundle/2/2.core ./target/wasm-gc/release/bundle/coverage/coverage.core ./target/wasm-gc/release/bundle/char/char.core ./target/wasm-gc/release/bundle/iter/iter.core ./target/wasm-gc/release/bundle/prelude/prelude.core -o ./target/wasm-gc/release/bundle/core.core
        "#]],
    );
    check(
        get_stdout(
            &dir,
            ["bundle", "--dry-run", "--target", "js", "--sort-input"],
        ),
        expect![[r#"
            moonc build-package -o ./target/js/release/bundle/prelude/prelude.core -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target js
            moonc build-package -o ./target/js/release/bundle/coverage/coverage.core -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target js
            moonc build-package -o ./target/js/release/bundle/iter/iter.core -pkg moonbitlang/core/iter -i ./target/js/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target js
            moonc build-package -o ./target/js/release/bundle/char/char.core -pkg moonbitlang/core/char -i ./target/js/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target js
            moonc build-package ./1/lib.mbt ./1/x.js.mbt -o ./target/js/release/bundle/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target js
            moonc build-package ./2/lib.mbt -o ./target/js/release/bundle/2/2.core -pkg moonbitlang/core/2 -i ./target/js/release/bundle/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target js
            moonc build-package ./0/lib.mbt ./0/y.js.mbt -o ./target/js/release/bundle/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target js
            moonc bundle-core ./target/js/release/bundle/0/0.core ./target/js/release/bundle/1/1.core ./target/js/release/bundle/2/2.core ./target/js/release/bundle/coverage/coverage.core ./target/js/release/bundle/char/char.core ./target/js/release/bundle/iter/iter.core ./target/js/release/bundle/prelude/prelude.core -o ./target/js/release/bundle/core.core
        "#]],
    );
    check(
        get_stdout(
            &dir,
            [
                "bundle",
                "--target",
                "all",
                "--dry-run",
                "--sort-input",
                "--serial",
            ],
        ),
        expect![[r#"
            moonc build-package -o ./target/wasm/release/bundle/prelude/prelude.core -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target wasm
            moonc build-package -o ./target/wasm/release/bundle/coverage/coverage.core -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target wasm
            moonc build-package -o ./target/wasm/release/bundle/iter/iter.core -pkg moonbitlang/core/iter -i ./target/wasm/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm
            moonc build-package -o ./target/wasm/release/bundle/char/char.core -pkg moonbitlang/core/char -i ./target/wasm/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm
            moonc build-package ./1/lib.mbt ./1/x.wasm.mbt -o ./target/wasm/release/bundle/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm
            moonc build-package ./2/lib.mbt -o ./target/wasm/release/bundle/2/2.core -pkg moonbitlang/core/2 -i ./target/wasm/release/bundle/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm
            moonc build-package ./0/lib.mbt ./0/y.wasm.mbt -o ./target/wasm/release/bundle/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm
            moonc bundle-core ./target/wasm/release/bundle/0/0.core ./target/wasm/release/bundle/1/1.core ./target/wasm/release/bundle/2/2.core ./target/wasm/release/bundle/coverage/coverage.core ./target/wasm/release/bundle/char/char.core ./target/wasm/release/bundle/iter/iter.core ./target/wasm/release/bundle/prelude/prelude.core -o ./target/wasm/release/bundle/core.core
            moonc build-package -o ./target/wasm-gc/release/bundle/prelude/prelude.core -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target wasm-gc
            moonc build-package -o ./target/wasm-gc/release/bundle/coverage/coverage.core -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target wasm-gc
            moonc build-package -o ./target/wasm-gc/release/bundle/iter/iter.core -pkg moonbitlang/core/iter -i ./target/wasm-gc/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target wasm-gc
            moonc build-package -o ./target/wasm-gc/release/bundle/char/char.core -pkg moonbitlang/core/char -i ./target/wasm-gc/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target wasm-gc
            moonc build-package ./1/lib.mbt ./1/x.wasm-gc.mbt -o ./target/wasm-gc/release/bundle/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target wasm-gc
            moonc build-package ./2/lib.mbt -o ./target/wasm-gc/release/bundle/2/2.core -pkg moonbitlang/core/2 -i ./target/wasm-gc/release/bundle/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target wasm-gc
            moonc build-package ./0/lib.mbt ./0/y.wasm-gc.mbt -o ./target/wasm-gc/release/bundle/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target wasm-gc
            moonc bundle-core ./target/wasm-gc/release/bundle/0/0.core ./target/wasm-gc/release/bundle/1/1.core ./target/wasm-gc/release/bundle/2/2.core ./target/wasm-gc/release/bundle/coverage/coverage.core ./target/wasm-gc/release/bundle/char/char.core ./target/wasm-gc/release/bundle/iter/iter.core ./target/wasm-gc/release/bundle/prelude/prelude.core -o ./target/wasm-gc/release/bundle/core.core
            moonc build-package -o ./target/js/release/bundle/prelude/prelude.core -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target js
            moonc build-package -o ./target/js/release/bundle/coverage/coverage.core -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target js
            moonc build-package -o ./target/js/release/bundle/iter/iter.core -pkg moonbitlang/core/iter -i ./target/js/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target js
            moonc build-package -o ./target/js/release/bundle/char/char.core -pkg moonbitlang/core/char -i ./target/js/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target js
            moonc build-package ./1/lib.mbt ./1/x.js.mbt -o ./target/js/release/bundle/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target js
            moonc build-package ./2/lib.mbt -o ./target/js/release/bundle/2/2.core -pkg moonbitlang/core/2 -i ./target/js/release/bundle/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target js
            moonc build-package ./0/lib.mbt ./0/y.js.mbt -o ./target/js/release/bundle/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target js
            moonc bundle-core ./target/js/release/bundle/0/0.core ./target/js/release/bundle/1/1.core ./target/js/release/bundle/2/2.core ./target/js/release/bundle/coverage/coverage.core ./target/js/release/bundle/char/char.core ./target/js/release/bundle/iter/iter.core ./target/js/release/bundle/prelude/prelude.core -o ./target/js/release/bundle/core.core
            moonc build-package -o ./target/native/release/bundle/prelude/prelude.core -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target native
            moonc build-package -o ./target/native/release/bundle/coverage/coverage.core -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target native
            moonc build-package -o ./target/native/release/bundle/iter/iter.core -pkg moonbitlang/core/iter -i ./target/native/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target native
            moonc build-package -o ./target/native/release/bundle/char/char.core -pkg moonbitlang/core/char -i ./target/native/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target native
            moonc build-package ./1/lib.mbt -o ./target/native/release/bundle/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target native
            moonc build-package ./2/lib.mbt -o ./target/native/release/bundle/2/2.core -pkg moonbitlang/core/2 -i ./target/native/release/bundle/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target native
            moonc build-package ./0/lib.mbt -o ./target/native/release/bundle/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target native
            moonc bundle-core ./target/native/release/bundle/0/0.core ./target/native/release/bundle/1/1.core ./target/native/release/bundle/2/2.core ./target/native/release/bundle/coverage/coverage.core ./target/native/release/bundle/char/char.core ./target/native/release/bundle/iter/iter.core ./target/native/release/bundle/prelude/prelude.core -o ./target/native/release/bundle/core.core
            moonc build-package -o ./target/native/release/bundle/prelude/prelude.core -pkg moonbitlang/core/prelude -pkg-sources moonbitlang/core/prelude:./prelude -target native
            moonc build-package -o ./target/native/release/bundle/coverage/coverage.core -pkg moonbitlang/core/coverage -pkg-sources moonbitlang/core/coverage:./coverage -target native
            moonc build-package -o ./target/native/release/bundle/iter/iter.core -pkg moonbitlang/core/iter -i ./target/native/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/iter:./iter -target native
            moonc build-package -o ./target/native/release/bundle/char/char.core -pkg moonbitlang/core/char -i ./target/native/release/bundle/coverage/coverage.mi:coverage -pkg-sources moonbitlang/core/char:./char -target native
            moonc build-package ./1/lib.mbt -o ./target/native/release/bundle/1/1.core -pkg moonbitlang/core/1 -pkg-sources moonbitlang/core/1:./1 -target native
            moonc build-package ./2/lib.mbt -o ./target/native/release/bundle/2/2.core -pkg moonbitlang/core/2 -i ./target/native/release/bundle/1/1.mi:1 -pkg-sources moonbitlang/core/2:./2 -target native
            moonc build-package ./0/lib.mbt -o ./target/native/release/bundle/0/0.core -pkg moonbitlang/core/0 -pkg-sources moonbitlang/core/0:./0 -target native
            moonc bundle-core ./target/native/release/bundle/0/0.core ./target/native/release/bundle/1/1.core ./target/native/release/bundle/2/2.core ./target/native/release/bundle/coverage/coverage.core ./target/native/release/bundle/char/char.core ./target/native/release/bundle/iter/iter.core ./target/native/release/bundle/prelude/prelude.core -o ./target/native/release/bundle/core.core
        "#]],
    );
}
